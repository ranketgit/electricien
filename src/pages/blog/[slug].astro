---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { title, description, date, image, categories } = post.data;
const { Content } = await post.render();

const formattedDate = new Date(date).toLocaleDateString('fr-BE', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const relatedPosts = allPosts
  .filter(p => p.slug !== post.slug && p.data.categories?.some(cat => categories?.includes(cat)))
  .slice(0, 3);
---

<Layout meta_title={title} meta_description={description}>
  <!-- Hero Section -->
  <section 
    class="relative bg-cover bg-center text-white"
    style={image ? `background-image: url('${image}');` : "background-image: url('/elec-express-votre-electricien.png');"}
  >
    <div class="absolute inset-0 bg-blue-900 opacity-70"></div>
    <div class="container mx-auto px-6 py-20 md:py-28 relative z-10 max-w-4xl">
      <!-- Breadcrumb -->
      <nav class="mb-8">
        <ol class="flex items-center space-x-2 text-sm text-gray-200">
          <li><a href="/" class="hover:text-yellow-400 transition-colors">Accueil</a></li>
          <li><span>/</span></li>
          <li><a href="/blog/" class="hover:text-yellow-400 transition-colors">Blog</a></li>
          <li><span>/</span></li>
          <li class="text-white truncate max-w-[200px]">{title}</li>
        </ol>
      </nav>

      <!-- Categories -->
      {categories && categories.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-6">
          {categories.map((category) => (
            <span class="text-xs sm:text-sm font-semibold bg-yellow-500 text-blue-900 px-3 py-1 rounded-full">
              {category}
            </span>
          ))}
        </div>
      )}

      <!-- Title -->
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold leading-tight mb-6">
        {title}
      </h1>

      <!-- Description -->
      <p class="text-lg md:text-xl text-gray-100 mb-6 max-w-3xl">
        {description}
      </p>

      <!-- Date -->
      <div class="flex items-center text-gray-200">
        <svg class="w-5 h-5 mr-2 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <time datetime={date.toISOString()}>{formattedDate}</time>
      </div>
    </div>
  </section>

  <!-- Article Content -->
  <article class="py-16 md:py-24 bg-white">
    <div class="container mx-auto px-6 max-w-3xl article-content">
      <Content />
    </div>
  </article>

  <!-- CTA Section -->
  <section class="py-16 md:py-24 bg-white">
    <div class="container mx-auto px-6 text-center">
      <div class="bg-gray-50 p-6 md:p-12 rounded-3xl shadow-xl max-w-3xl mx-auto">
        <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-6">
          Besoin d'un <strong class="text-yellow-500">Ã‰lectricien</strong> ?
        </h2>
        <p class="text-base sm:text-lg text-gray-700 mb-10">
          N'attendez pas ! Contactez <strong>Elec Express</strong> dÃ¨s aujourd'hui pour une
          <strong>intervention rapide 24/7</strong> partout en <strong>Belgique</strong>.
        </p>
        <a href="tel:+32470424242" title="TÃ©lÃ©phone Elec Express"
          class="w-full sm:w-auto inline-block px-6 py-3 sm:px-8 rounded-xl font-semibold shadow-md transition duration-300 ease-in-out bg-yellow-500 text-white hover:bg-yellow-600 text-base sm:text-lg">
          ðŸ“ž 0470/42.42.42
        </a>
      </div>
    </div>
  </section>

  <!-- Related Posts -->
  {relatedPosts.length > 0 && (
    <section class="py-16 md:py-24 bg-gray-50">
      <div class="container mx-auto px-6">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 text-center mb-12">
          Articles Similaires
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
          {relatedPosts.map((relatedPost, index) => (
            <a 
              href={`/blog/${relatedPost.slug}/`} 
              class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-shadow duration-300 group block"
              data-aos="fade-up"
              data-aos-delay={((index % 3) * 100).toString()}
            >
              {relatedPost.data.image && (
                <img 
                  src={relatedPost.data.image} 
                  alt={relatedPost.data.title}
                  class="w-full h-48 object-cover rounded-xl mb-4"
                  loading="lazy"
                />
              )}
              <h3 class="text-lg font-semibold text-gray-800 group-hover:text-yellow-600 transition-colors mb-2">
                {relatedPost.data.title}
              </h3>
              <p class="text-gray-600 text-sm line-clamp-2">
                {relatedPost.data.description}
              </p>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Back to Blog -->
  <div class="bg-white py-8">
    <div class="container mx-auto px-6 text-center">
      <a href="/blog/" class="inline-flex items-center text-gray-600 hover:text-yellow-600 transition-colors font-medium">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Retour au Blog
      </a>
    </div>
  </div>
</Layout>

<style is:global>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .article-content {
    font-size: 1.125rem;
    line-height: 1.8;
    color: #4b5563;
  }

  .article-content > * + * {
    margin-top: 1.5rem;
  }

  .article-content h1 {
    font-size: 2.25rem;
    font-weight: 700;
    color: #111827;
    margin-top: 3rem;
    margin-bottom: 1rem;
    line-height: 1.3;
  }

  .article-content h2 {
    font-size: 1.75rem;
    font-weight: 700;
    color: #111827;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #eab308;
    line-height: 1.3;
  }

  .article-content h3 {
    font-size: 1.375rem;
    font-weight: 600;
    color: #111827;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    line-height: 1.4;
  }

  .article-content h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #111827;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .article-content p {
    margin-bottom: 1.5rem;
    line-height: 1.8;
  }

  .article-content a {
    color: #ca8a04;
    font-weight: 500;
    text-decoration: underline;
    text-underline-offset: 2px;
    transition: color 0.2s;
  }

  .article-content a:hover {
    color: #a16207;
  }

  .article-content strong {
    color: #111827;
    font-weight: 600;
  }

  .article-content ul {
    margin: 1.5rem 0;
    padding-left: 1.5rem;
    list-style-type: disc;
  }

  .article-content ol {
    margin: 1.5rem 0;
    padding-left: 1.5rem;
    list-style-type: decimal;
  }

  .article-content li {
    margin-bottom: 0.75rem;
    padding-left: 0.5rem;
    line-height: 1.7;
  }

  .article-content li::marker {
    color: #eab308;
  }

  .article-content blockquote {
    border-left: 4px solid #eab308;
    padding: 1rem 1.5rem;
    margin: 2rem 0;
    background-color: #fefce8;
    border-radius: 0 0.75rem 0.75rem 0;
    font-style: italic;
    color: #4b5563;
  }

  .article-content img {
    border-radius: 1rem;
    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    margin: 2rem auto;
    max-width: 100%;
    height: auto;
    display: block;
  }

  .article-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    font-size: 0.95rem;
    overflow: hidden;
    border-radius: 0.75rem;
    box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
  }

  .article-content thead {
    background-color: #eab308;
  }

  .article-content th {
    color: white;
    padding: 1rem;
    text-align: left;
    font-weight: 600;
  }

  .article-content td {
    border: 1px solid #e5e7eb;
    padding: 0.875rem 1rem;
    color: #4b5563;
  }

  .article-content tbody tr:nth-child(even) {
    background-color: #f9fafb;
  }

  .article-content tbody tr:hover {
    background-color: #fefce8;
  }

  .article-content code {
    background-color: #f3f4f6;
    padding: 0.2rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-family: ui-monospace, monospace;
    color: #374151;
  }

  .article-content pre {
    background-color: #1e293b;
    color: #e5e7eb;
    padding: 1.5rem;
    border-radius: 0.75rem;
    overflow-x: auto;
    margin: 2rem 0;
    font-size: 0.875rem;
  }

  .article-content pre code {
    background: none;
    padding: 0;
    color: inherit;
    font-size: inherit;
  }

  .article-content hr {
    border: none;
    border-top: 2px solid #e5e7eb;
    margin: 3rem 0;
  }

  @media (min-width: 1024px) {
    .article-content {
      font-size: 1.175rem;
    }
    
    .article-content h1 {
      font-size: 2.5rem;
    }
    
    .article-content h2 {
      font-size: 2rem;
    }
    
    .article-content h3 {
      font-size: 1.5rem;
    }
  }
</style>